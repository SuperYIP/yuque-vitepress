> 参考：
> [https://www.bilibili.com/video/BV1bS4y1b7NV?p=20&vd_source=d2ee6de80aecd10f87a2ffa4e6eea5b8](https://www.bilibili.com/video/BV1bS4y1b7NV?p=20&vd_source=d2ee6de80aecd10f87a2ffa4e6eea5b8)
> 

### react中DOM渲染逻辑（**在没有指定key时**）
比较两次数据时，React会先比较父元素，父元素如果不同，直接所有元素全部替换。父元素一致，在去逐个比较子元素，直到找到所有发生变化的元素为止。

- 下例中，新旧两组数据完全一致，所以没有任何DOM对象被修改。
```javascript
/*
* 旧数据
*       ul
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*  新数据
*       ul
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*/
```

- 下例中，只有第一个li发生变化，所以只有第一个li被修改，其他元素不变。
```javascript
/*
* 旧数据
*       ul
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*  新数据
*       ul
*           li>tom
*           li>猪八戒
*           li>沙和尚
*/
```

- 下例中，在列表的最后添加了一个新元素，并没有改变其他的元素的顺序，只有新添加的元素会被渲染，所以这种操作不会带来性能问题。
```javascript
/*
*   旧数据
*       ul
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*   新数据
*       ul
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*           li>唐僧
*/
```

- 下例中，在列表的最前边插入了一个新元素，其他元素内容并没有发生变化，但是由于新元素插入到了开始位置，其余元素的位置全都发生变化，而React默认是根据位置比较元素，所以此时，所有元素都会被修改，这种操作就会带来性能问题。
```javascript
/*
*   旧数据
*       ul
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*   新数据
*       ul
*           li>唐僧
*           li>孙悟空
*           li>猪八戒
*           li>沙和尚
*/
```
### react中DOM渲染逻辑（**指定key后**）
**为什么要给列表中的每个元素指定key：**为了解决上述问题，React为列表设计了一个key属性，当设置key以后，再比较元素时，就会比较相同key的元素，而不是按照顺序进行比较。

- 下例中，给列表中的每个元素指定了key，会比较相同key的元素，而不是按照顺序进行比较，所以此时只有新添加的元素会被渲染，不再会带来性能问题。
```javascript
/*
*   旧数据
*       ul
*           li(key=孙悟空)>孙悟空
*           li(key=猪八戒)>猪八戒
*           li(key=沙和尚)>沙和尚
*   新数据
*       ul
*           li(key=唐僧)>唐僧
*           li(key=孙悟空)>孙悟空
*           li(key=猪八戒)>猪八戒
*           li(key=沙和尚)>沙和尚
*/
```
### 为什么不要使用索引作为key
索引会跟着元素顺序的改变而改变，所以使用索引做key跟没有key是一样的，会带来性能问题，唯一的不同就是，控制台的警告没了。只有当元素的顺序不会发生变化时，用索引做key才没有什么问题。

- 下例中，使用索引做key，当在列表头部加入数据时，新旧数据对应元素的key都不同，所有元素都会被重新渲染，会带来性能问题。
```javascript
/*
*   旧数据
*       ul
*           li(key=0)>孙悟空
*           li(key=1)>猪八戒
*           li(key=2)>沙和尚
*   新数据
*       ul
*           li(key=0)>唐僧
*           li(key=1)>孙悟空
*           li(key=2)>猪八戒
*           li(key=3)>沙和尚
*/
```
 
